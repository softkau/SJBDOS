# SJBDOS
A random OS for hobby project.  
(re-coded [MikanOS](https://github.com/uchan-nos/mikanos) for learning purposes)  
(credits to [Uchida Kota](https://github.com/uchan-nos) for making this project possible)
## Video Demo
[![demo](http://img.youtube.com/vi/eUbBKmzVzIs/0.jpg)](http://www.youtube.com/watch?v=eUbBKmzVzIs "ÏûêÏûë os")

## ‚úÖAdditional Features Implemented
* partial support for Long File Names in FAT file system.

## üìùTODOs
* PATA/SATA driver support
* support for GRUB
* kernel-free terminal
* other cool features
## ‚öôHow to Build(important)
### ‚õîDisclaimer
Compilation has only been tested on Ubuntu 22.04 LTS.  
It may or maynot fail to compile/link in other versions of
Ubuntu.  

### üëâSetting up build environment
First, clone the repository:
```bash
git clone https://github.com/softkau/SJBDOS.git
```
Next, install ansible on your system. We'll use it to setup
development environment. (like installing cross compiler and
stuff)
```bash
sudo apt install ansible
```
Then, setup `devenv` by running ansible:
```bash
cd SJBDOS/devenv && \
ansible-playbook -K -i ansible_inventory ansible_provision.yml
```
This may take several minutes.  
It'll install bunch of stuff:
* EDK2 ([EFI Development Kit](https://github.com/tianocore/edk2); for bootloader!)
* x86 libc++
* iasl (check if the command is installed correctly by `iasl -v`)
* some other random stuff i don't know lol

You'll notice that `edk2` and `x86_64-elf` folder now appear in
your `devenv` directory.  
Optionally, you need to run this command if you're using WSL/WSL2.
This sets up the `DISPLAY` environment variable.
```bash
source ~/.profile # generated by ansible-playbook
```
### üëâBuilding the bootloader (SJBDLoaderPkg)
Change directory to `SJBDLoaderPkg`.
```bash
cd ../day02/SJBDLoaderPkg # SJBDOS/day02/SJBDLoaderPkg
```
Run this script:
```bash
source setup.sh
```
This will create some symlinks that you need to build the loader.  
Now go to `edk2` folder and run `edksetup.sh`
```bash
cd ../../devenv/edk2 && source edksetup.sh
```
This will generate config file: `Conf/target.txt`. Modify its
value like the following:
| key             | value                           |
|-----------------|---------------------------------|
| ACTIVE_PLATFORM | SJBDLoaderPkg/SJBDLoaderPkg.dsc |
| TARGET          | DEBUG                           |
| TARGET_ARCH     | X64                             |
| TOOL_CHAIN_TAG  | CLANG38                         |

Now we build the bootloader!
```bash
build
```
### üëâBuilding the kernel and run (on QEMU)
This command will setup libc++ PATH for clang.
```bash
cd ../../ && source devenv/buildenv.sh
```
Change directory to `day02`:
```bash
cd day02
```
Finally, build kernel and run!
```bash
APPS_DIR=apps RESOURCE_DIR=resource ./build.sh run
```
### üëâHow do I re-build again?
For bootloader, you need to do the following in `edk2` folder:
```bash
source edksetup.sh && \
build
```
(Notice that you need to re-run edksetup.
Otherwise, the `build` command won't work)  

For kernel, you need to do the following in `day02` folder:
```bash
APPS_DIR=apps RESOURCE_DIR=resource ./build.sh run
```
If something fails, `make clean` inside `day02/kernel` folder
mostly solves everything. (Makefile is kinda buggy right now)

### üëâHow do I debug kernel with GDB?
You probably want to debug in unoptimized build
to prevent extra headache:
```bash
APPS_DIR=apps RESOURCE_DIR=resource ./build.sh debug
```
And now open a new terminal, and go to the same directory(`day02`).  
Run: `./rungdb.sh`.  
This will make gdb attach to currently running qemu session.